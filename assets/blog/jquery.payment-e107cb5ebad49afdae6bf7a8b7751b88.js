(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m=this;e=jQuery,v=function(e){return(e+"").replace(/^\s+|\s+$/g,"")},t=function(){var e,t,n,r;t={};for(e=n=40;n<=49;e=++n)t[e]="visa";for(e=r=50;r<=59;e=++r)t[e]="mastercard";return t[34]=t[37]="amex",t[60]=t[62]=t[64]=t[65]="discover",t[35]="jcb",t[30]=t[36]=t[38]=t[39]="dinersclub",t}(),f=function(e){var t,n,r,i,s,o;r=!0,i=0,n=(e+"").split("").reverse();for(s=0,o=n.length;s<o;s++){t=n[s],t=parseInt(t,10);if(r=!r)t*=2;t>9&&(t-=9),i+=t}return i%10===0},a=function(e){var t;return e.prop("selectionStart")!=null&&e.prop("selectionStart")!==e.prop("selectionEnd")?!0:(typeof document!="undefined"&&document!==null?(t=document.selection)!=null?typeof t.createRange=="function"?t.createRange().text:void 0:void 0:void 0)?!0:!1},i=function(t){var n,r,i,s,o,u;r=String.fromCharCode(t.which);if(!/^\d+$/.test(r))return;n=e(t.currentTarget),u=n.val(),o=e.cardType(u+r),i=(u.replace(/\D/g,"")+r).length;if(o==="amex"){if(i>=15)return}else if(i>=16)return;if(n.prop("selectionStart")!=null&&n.prop("selectionStart")!==u.length)return;o==="amex"?s=/^(\d{4}|\d{4}\s\d{6})$/:s=/(?:^|\s)(\d{4})$/;if(s.test(u))return t.preventDefault(),n.val(u+" "+r);if(s.test(u+r))return t.preventDefault(),n.val(u+r+" ")},n=function(t){var n,r;n=e(t.currentTarget),r=n.val();if(t.meta)return;if(n.prop("selectionStart")!=null&&n.prop("selectionStart")!==r.length)return;if(t.which===8&&/\s\d?$/.test(r))return t.preventDefault(),n.val(r.replace(/\s\d?$/,""))},s=function(t){var n,r,i;r=String.fromCharCode(t.which);if(!/^\d+$/.test(r))return;n=e(t.currentTarget),i=n.val()+r;if(/^\d$/.test(i)&&i!=="0"&&i!=="1")return t.preventDefault(),n.val("0"+i+" / ");if(/^\d\d$/.test(i))return t.preventDefault(),n.val(""+i+" / ")},o=function(t){var n,r,i;r=String.fromCharCode(t.which);if(!/^\d+$/.test(r))return;n=e(t.currentTarget),i=n.val();if(/^\d\d$/.test(i))return n.val(""+i+" / ")},u=function(t){var n,r,i;r=String.fromCharCode(t.which);if(r!=="/")return;n=e(t.currentTarget),i=n.val();if(/^\d$/.test(i)&&i!=="0")return n.val("0"+i+" / ")},r=function(t){var n,r;if(t.meta)return;n=e(t.currentTarget),r=n.val();if(t.which!==8)return;if(n.prop("selectionStart")!=null&&n.prop("selectionStart")!==r.length)return;if(/\s\/\s?$/.test(r))return t.preventDefault(),n.val(r.replace(/\s\/\s?$/,""))},p=function(e){var t;return e.metaKey?!0:e.which===32?!1:e.which===0?!0:e.which<33?!0:(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))},c=function(t){var n,r,i;n=e(t.currentTarget),r=String.fromCharCode(t.which);if(!/^\d+$/.test(r))return;if(a(n))return;return i=n.val()+r,i=i.replace(/\D/g,""),e.cardType(i)==="amex"?i.length<=15:i.length<=16},h=function(t){var n,r,i;n=e(t.currentTarget),r=String.fromCharCode(t.which);if(!/^\d+$/.test(r))return;if(a(n))return;i=n.val()+r,i=i.replace(/\D/g,"");if(i.length>6)return!1},l=function(t){var n,r;return n=e(t.currentTarget),r=n.val(),r.length<=4},d=function(t){var n,r,i;n=e(t.currentTarget),i=n.val(),r=e.cardType(i)||"unknown";if(!n.hasClass(r))return n.removeClass("visa amex mastercard discover dinersclub jcb unknown"),n.addClass(r),n.toggleClass("identified",r!=="unknown"),n.trigger("payment.cardType",r)},e.fn.formatCardCVC=function(){return this.restrictNumeric(),this.on("keypress",l)},e.fn.formatCardExpiry=function(){return this.restrictNumeric(),this.on("keypress",h),this.on("keypress",s),this.on("keypress",u),this.on("keypress",o),this.on("keydown",r)},e.fn.formatCardNumber=function(){return this.restrictNumeric(),this.on("keypress",c),this.on("keypress",i),this.on("keydown",n),this.on("keyup",d)},e.fn.restrictNumeric=function(){return this.on("keypress",p)},e.fn.cardExpiryVal=function(){return e.cardExpiryVal(e(this).val())},e.cardExpiryVal=function(e){var t,n,r,i;return e=e.replace(/\s/g,""),i=e.split("/",2),t=i[0],r=i[1],(r!=null?r.length:void 0)===2&&/^\d+$/.test(r)&&(n=(new Date).getFullYear(),n=n.toString().slice(0,2),r=n+r),t=parseInt(t,10),r=parseInt(r,10),{month:t,year:r}},e.validateCardNumber=function(e){return e=(e+"").replace(/\s+|-/g,""),e.length>=10&&e.length<=16&&f(e)},e.validateCardExpiry=function(e,t){var n,r,i;return typeof e=="object"&&"month"in e&&(i=e,e=i.month,t=i.year),!e||!t?!1:(e=v(e),t=v(t),/^\d+$/.test(e)?/^\d+$/.test(t)?parseInt(e,10)<=12?(r=new Date(t,e),n=new Date,r.setMonth(r.getMonth()-1),r.setMonth(r.getMonth()+1,1),r>n):!1:!1:!1)},e.validateCardCVC=function(e,t){return e=v(e),/^\d+$/.test(e)?t?t==="amex"?e.length===4:e.length===3:e.length>=3&&e.length<=4:!1},e.cardType=function(e){return t[e.slice(0,2)]||null}}).call(this);